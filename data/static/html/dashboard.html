{% extends "base.html" %} {% block title %} –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –®–ö {% endblock %} {%
block base_content %}

<div class="container mt-5">
  <div class="row">
    <div class="col-md-8">
      <div class="d-flex align-items-center mb-3">
        <img class="me-3" width="60" height="60"
          src="https://img.icons8.com/external-vitaliy-gorbachev-lineal-color-vitaly-gorbachev/60/external-astronaut-space-vitaliy-gorbachev-lineal-color-vitaly-gorbachev-4.png"
          alt="external-astronaut-space-vitaliy-gorbachev-lineal-color-vitaly-gorbachev-4" />
        <div>
          <h1>{{user.fullName}}</h1>
          <p>{{user.email}}</p>
        </div>
      </div>
      <p>
        {% if user.phone is not none and user.phone != "" %} –¢–µ–ª–µ—Ñ–æ–Ω:
        {{user.phone}} <br />
        {% endif %} {% if user.parentPhone is not none and user.parentPhone !=
        "" %} –¢–µ–ª–µ—Ñ–æ–Ω —Ä–æ–¥–∏—Ç–µ–ª—è: {{user.parentPhone}} <br />
        {% endif %} –®–∫–æ–ª–∞: {{user.school}}, {{user.schoolClass}} –∫–ª–∞—Å—Å <br />
      </p>
      <button data-bs-toggle="modal" data-bs-target="#setPasswordModal" class="btn btn-primary mb-3">–°–º–µ–Ω–∏—Ç—å
        –ø–∞—Ä–æ–ª—å</button>

      <div class="modal fade" id="setPasswordModal" tabindex="-1" role="dialog" aria-labelledby="addProgramModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addProgramModalLabel">
                –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
              </h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form method="POST" action="/change_password" id="set-password-form">
                <label class="form-label mt-3">–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å</label>
                <input type="password" class="form-control" name="old_password">
                <label class="form-label mt-3">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <input type="password" class="form-control" name="new_password">
                <label class="form-label mt-3">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –µ—â–µ —Ä–∞–∑</label>
                <input type="password" class="form-control" name="new_password_confirm">

                <button type="submit" class="btn btn-primary mt-3">
                  –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <a href="/application" class="btn btn-success mb-3">
        –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ
      </a>
    </div>
    {% if user.completedPrograms %}
    <div class="col-md-8">
      <h4>–ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–±—É—á–µ–Ω–∏—è</h4>
      <ul class="list-group mb-3">
        {% for completedProgram in user.completedPrograms %}
        <li class="list-group-item">{{completedProgram.brief}} ({{completedProgram.year}}), –û—Ü–µ–Ω–∫–∞: {{completedProgram.grade}}{% if completedProgram.diploma %}<p class="ml-1" data-bs-toggle="tooltip" data-bs-placement="left" title="–ì—Ä–∞–º–æ—Ç–∞ –∑–∞ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–µ–¥–∏ –≥—Ä—É–ø–ø—ã">üëë</p>{% endif %}</li>
        {% endfor %}
      </ul>
      {% if user.applicationSelectedProgram is not none %}
      <h4>–ê–∫—Ç–∏–≤–Ω–∞—è –∑–∞—è–≤–∫–∞: {{user.applicationSelectedProgram}}</h4>
      <p>–°—Ç–∞—Ç—É—Å: {{user.applicationStatus}}</p>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>
<!-- <h3>–ñ—É—Ä–Ω–∞–ª</h3>
<iframe width="100%" height="500px"
  src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTLf05cGQ5A_UXdE_1poSY2MAYiyzzsxsbXqJg8Rl-OqKm1lcyVaUChmpYT1K0lvwps5BtZOzizZQmd/pubhtml?widget=true&amp;headers=false"></iframe> -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    $("#set-password-form").submit(function (event) {
      event.preventDefault();
      if (
        $("#set-password-form input[name=new_password]").val() !=
        $("#set-password-form input[name=new_password_confirm]").val()
      ) {
        alert("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç");
        return;
      }

      fetch("/change_password", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          oldPassword: $("#set-password-form input[name=old_password]").val(),
          newPassword: $("#set-password-form input[name=new_password]").val(),
        }),
      }).then(function (response) {
        if (response.ok) {
          alert("–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω");
          window.location.reload();
        } else {
          alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å");
        }
      });
    });
  });
</script>
{% endblock %}